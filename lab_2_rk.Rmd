---
title: "Lab 2"
author: "Roshni Katrak-Adefowora"
date: "1/14/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(janitor)
library(palmerpenguins)
library(here)

#For PCA
library(ggfortify)

#For ggplot customization
library(readxl)
library(gghighlight)
library(lubridate)
library(plotly)

#To make compound figures
library(patchwork)
```

## Part 1: PCA with penguins

```{r}
penguin_pca <- penguins %>% 
  select(body_mass_g, ends_with("_mm")) %>% 
  drop_na() %>% 
  scale() %>% #scale data
  prcomp() #run PCA

penguin_pca$rotation

#make biplot

penguin_complete <- penguins %>% 
  drop_na(body_mass_g, ends_with("mm")) #keep same observations that exist in PCA biplot (they HAVE to match), but also contain other variables not included in PCA but that we might use to change aesthetics of graph (i.e., color based on species)

autoplot(penguin_pca,
         data=penguin_complete,
         colour="species", #must be spelled "colour"
         loadings=T,
         loadings.label=T)+
  theme_minimal()
#see example code for more customization
```

## Part 2: ggplot customization & reading in different file types

### Read in an .xlsx file & do some wrangling

```{r}
fish_noaa <- read_excel(here("data", "foss_landings.xlsx")) %>% 
  clean_names() %>% 
  mutate(across(where(is.character), tolower)) %>% #put everything in lowercase (for any character column)
  mutate(nmfs_name = str_sub(nmfs_name, end=-4)) %>%  #get rid of " **" at the end of each name (keep original name, but remove last 4 characters)
  filter(confidentiality=="public")
```

Make a customized graph
```{r}
fish_plot <- ggplot(data=fish_noaa, aes(x=year, y=pounds))+
  geom_line(aes(color=nmfs_name), show.legend=F)+
  theme_minimal()

fish_plot

#make interactive graph
ggplotly(fish_plot)

#use gghighlight to highlight certain series
ggplot(data=fish_noaa, aes(x=year, y=pounds, group=nmfs_name))+
  geom_line()+
  theme_minimal()+
  gghighlight(nmfs_name=="tunas") #highlight based on name "tuna"

ggplot(data=fish_noaa, aes(x=year, y=pounds, group=nmfs_name))+
  geom_line(aes(color=nmfs_name))+
  theme_minimal()+
  gghighlight(max(pounds) > 1e8) #highlight based on values
```

